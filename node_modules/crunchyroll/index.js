var http = require('http');
var cheerio = require('cheerio');
var request = require('request');
var compile = require('string-template/compile');



module.exports.AnimeSearch = function(anime, callback){
	var JSON_Object = {
		anime: {
			Seasons:[
				{ Title:"", Episodes:"" }
				]
		}
	
	};
	request('http://www.crunchyroll.com/' + anime.replace(/( )|(\+)/g, "-"), function(err, res, body){
		if(!err && res.statusCode == 200){
			$ = cheerio.load(body);
			JSON_Object.anime.Description = $('.more').text();
				if($('.season').children().length > 1){
					for(i = ($('.list-of-seasons.cf').children().length - 2); i >= 0; i--)
					{
						
						JSON_Object.anime.Seasons.push({ Title:$('.list-of-seasons > li > a').eq(i).attr('title'), Episodes:$('.list-of-seasons > li > ul').eq(i).children('li').length });
					}		
					JSON_Object.anime.Seasons[0].Title = $('.season:last-child > a').attr('title');
					JSON_Object.anime.Seasons[0].Episodes = $('.season:last-child > ul > li').length;
			}else{
				JSON_Object.anime.Seasons[0].Title = $('.ellipsis span').text();
				JSON_Object.anime.Seasons[0].Episodes = $('.season > ul.portrait-grid > li').length.toString();
			}
			
			callback(JSON_Object);
		}
	});
}
